<script src="
https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.12.1/dist/dsfr.module.min.js
"></script>
<link href="
https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.12.1/dist/dsfr.min.css
" rel="stylesheet">

<header role="banner" class="fr-header">
    <div class="fr-header__body">
        <div class="fr-container">
            <div class="fr-header__body-row">
                <div class="fr-header__brand fr-enlarge-link">
                    <div class="fr-header__brand-top">
                        <div class="fr-header__logo">
                            <p class="fr-logo">
                                RÉPUBLIQUE
                                <br>FRANÇAISE
                            </p>
                        </div>
                    </div>
                    <div class="fr-header__service">
                        <a href="/" title="Accueil - [À MODIFIER - Nom du site / service] - Nom de l’entité (ministère, secrétariat d‘état, gouvernement)">
                            <p class="fr-header__service-title">
                                numerique.gouv.fr
                            </p>
                        </a>
                        <p class="fr-header__service-tagline">Offres Cloud Interministériel</p>
                    </div>
                </div>
          </div>
        </div>
    </div>
    <div class="fr-notice fr-notice--warning">
        <div class="fr-container">
            <div class="fr-notice__body">
                <p>
                    <span class="fr-notice__title">En cours de construction</span>
                    <span class="fr-notice__desc">Le contenu est en cours de rédaction, les informations présentes peuvent être incorrectes.</span>
                </p>
                <button title="Masquer le message" onclick="const notice = this.parentNode.parentNode.parentNode; notice.parentNode.removeChild(notice)" id="button-1305" class="fr-btn--close fr-btn">Masquer le message</button>
            </div>
        </div>
    </div>
</header>


<div class="fr-container">
  <div class="fr-grid-row fr-grid-row--gutters fr-mt-12v">
    <div class="fr-col-12 fr-col-md-12">
        <ul class="fr-btns-group fr-btns-group--lg">
            <li>
              <a href="mailto:julien.dauphant@beta.gouv.fr" class="fr-btn">
                      Besoin d'aide ? contactez-nous : julien.dauphant@beta.gouv.fr
              </a>
            </li>
        </ul>
    </div>
    <div class="fr-col-12 fr-col-md-12">
      <h1>
      Disponible
      </h1>
    </div>
    <div class="fr-col-12 fr-col-md-12">
        <div class="fr-grid-row fr-grid-row--gutters" id="cards-row-disponible">
        <!-- Les cartes seront insérées ici -->
      </div>
    </div>
     <div class="fr-col-12 fr-col-md-12">
      <h1>
      Bientôt disponible
      </h1>
    </div>
    <div class="fr-col-12 fr-col-md-12">
        <div class="fr-grid-row fr-grid-row--gutters " id="cards-row-bientot">
        <!-- Les cartes seront insérées ici -->
      </div>
    </div>
    <div class="fr-col-12 fr-col-md-12">
        <ul class="fr-btns-group fr-btns-group--lg">
            <li>
              <a href="mailto:julien.dauphant@beta.gouv.fr" class="fr-btn">
                      Besoin d'aide ? contactez-nous : julien.dauphant@beta.gouv.fr
              </a>
            </li>
        </ul>
    </div>
  </div>
</div>

<footer class="fr-footer" role="contentinfo" id="footer-7361">
  <div class="fr-container">
    <div class="fr-footer__body">
      <div class="fr-footer__brand fr-enlarge-link">
        <a href="/" title="Retour à l'accueil du site - Nom de l'entité (ministère, secrétariat d'état, gouvernement)">
          <p class="fr-logo">RÉPUBLIQUE <br>FRANÇAISE </p>
        </a>
      </div>
      <div class="fr-footer__content">
        <p class="fr-footer__content-desc">Ce site est opéré par la DINUM</p>
        <ul class="fr-footer__content-list">
          <li class="fr-footer__content-item">
            <a class="fr-footer__content-link" target="_blank" rel="noopener external" title="info.gouv.fr - nouvelle fenêtre" href="https://info.gouv.fr">info.gouv.fr</a>
          </li>
          <li class="fr-footer__content-item">
            <a class="fr-footer__content-link" target="_blank" rel="noopener external" title="service-public.fr - nouvelle fenêtre" href="https://service-public.fr">service-public.fr</a>
          </li>
          <li class="fr-footer__content-item">
            <a class="fr-footer__content-link" target="_blank" rel="noopener external" title="legifrance.gouv.fr - nouvelle fenêtre" href="https://legifrance.gouv.fr">legifrance.gouv.fr</a>
          </li>
          <li class="fr-footer__content-item">
            <a class="fr-footer__content-link" target="_blank" rel="noopener external" title="data.gouv.fr - nouvelle fenêtre" href="https://data.gouv.fr">data.gouv.fr</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="fr-footer__bottom">
      <ul class="fr-footer__bottom-list">
        <li class="fr-footer__bottom-item">
          <a class="fr-footer__bottom-link" href="#">Accessibilité : non conforme</a>
        </li>
        <li class="fr-footer__bottom-item">
          <a class="fr-footer__bottom-link" href="https://www.numerique.gouv.fr/mentions-legales/">Mentions légales</a>
        </li>
        <li class="fr-footer__bottom-item">
          <a class="fr-footer__bottom-link" href="https://www.numerique.gouv.fr/donnees-personnelles-cookies/">Données personnelles et cookies</a>
        </li>
      </ul>
      <div class="fr-footer__bottom-copy">
        <p>Sauf mention explicite de propriété intellectuelle détenue par des tiers, les contenus de ce site sont proposés sous <a href="https://github.com/etalab/licence-ouverte/blob/master/LO.md" target="_blank" rel="noopener external" title="Licence etalab - nouvelle fenêtre">licence etalab-2.0</a>
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
async function fetchDataAndGenerateHTML() {
    const response = await fetch('https://grist.incubateur.net/api/docs/9Ln1M4WDNZxZ/tables/1/records');
    const data = await response.json();
    const records = data.records;
    const cardsRowDisponible = document.getElementById('cards-row-disponible');
    const cardsRowBientot = document.getElementById('cards-row-bientot');

    // Récupérer tous les types d'accès possibles en excluant la première valeur de chaque liste
    const allAccessTypes = new Set();
    records.forEach(record => {
        record.fields.Accessible_depuis_.slice(1).forEach(access => {
            allAccessTypes.add(access);
        });
    });

    let cardsDisponibleHtml = '';
    let cardsBientotHtml = '';

    records.forEach(record => {
        const fields = record.fields;

        const titleHtml = fields.Lien 
            ? `<a href="${fields.Lien}" target="_blank">${fields.Nom_de_l_offre}</a>` 
            : `${fields.Nom_de_l_offre}`;

        const accessBadges = Array.from(allAccessTypes).map(access => {
            const badgeClass = fields.Accessible_depuis_.includes(access) ? 'fr-badge--success' : 'fr-badge--error';
            return `<li><p class="fr-badge ${badgeClass}">${access}</p></li>`;
        }).join('');

        const apiBadge = `<li><p class="fr-badge ${fields.API ? 'fr-badge--success' : 'fr-badge--error'}">API</p></li>`;

        const cardHtml = `
            <div class="fr-col-12 fr-col-md-4">
                <div class="fr-card fr-enlarge-link fr-card--horizontal">
                    <div class="fr-card__body">
                        <div class="fr-card__content">
                            <h3 class="fr-card__title">${titleHtml}</h3>
                            <p class="fr-card__desc">${fields.Description || 'Description non disponible'}</p>
                            <div class="fr-card__start">
                                <ul class="fr-tags-group">
                                    <li><p class="fr-tag">${fields.Fournisseur}</p></li>
                                </ul>
                                Accessible depuis : <ul class="fr-badges-group">
                                    ${accessBadges}
                                </ul><br>
                                <ul class="fr-badges-group">
                                    ${apiBadge}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;

        if (fields.Disponibilite === 'Disponible') {
            cardsDisponibleHtml += cardHtml;
        } else {
            cardsBientotHtml += cardHtml;
        }
    });

    cardsRowDisponible.innerHTML = cardsDisponibleHtml;
    cardsRowBientot.innerHTML = cardsBientotHtml;
}

fetchDataAndGenerateHTML();
</script>




